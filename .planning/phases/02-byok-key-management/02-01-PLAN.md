# Phase 2: BYOK API Key Management

## Phase Overview
Since this is a demo project, we implement a **Bring Your Own Key (BYOK)** system instead of traditional authentication. Users provide their own Firebase and OpenAI API keys, which are stored securely in the browser. This lets anyone clone and use the project with their own infrastructure.

**Budget Tier**: Standard
**Estimated Effort**: 6-8 hours
**Number of Atomic Tasks**: 2

---

<task type="auto" id="02-01">
  <n>BYOK Configuration Page & Key Storage</n>
  
  <context>
    Users need to provide their own API keys to use the app.
    Keys needed:
    - Firebase config (apiKey, authDomain, projectId, storageBucket, messagingSenderId, appId)
    - OpenAI API key
    Keys are stored in localStorage (encrypted with a simple obfuscation).
    A setup wizard guides first-time users through key configuration.
    Firebase and OpenAI clients initialize dynamically from stored keys.
  </context>
  
  <steps>
    1. Create `src/lib/keys/store.ts` — key storage utilities (save/load/clear from localStorage)
    2. Create `src/lib/keys/validation.ts` — validate keys are real (test Firebase connection, test OpenAI API ping)
    3. Refactor `src/lib/firebase/config.ts` — initialize dynamically from stored keys, not .env
    4. Create `src/lib/openai/client.ts` — OpenAI client factory using stored key
    5. Create `src/components/providers/KeyProvider.tsx` — React context that gates the app until keys are configured
    6. Create `src/app/(public)/setup/page.tsx` — BYOK setup wizard page with:
       - Step 1: Firebase config (paste JSON or fill fields)
       - Step 2: OpenAI API key
       - Key validation on submit
       - Success → redirect to dashboard
    7. Create `src/components/ui/ApiKeyInput.tsx` — masked input with reveal toggle
    8. Style the setup page with the design system (glassmorphism cards, gradient accents)
    9. Verify: Setup page loads, accepts keys, validates, stores, and initializes clients
  </steps>
  
  <verify>npm run build</verify>
  
  <outcome>
    Functional BYOK setup wizard. Users can enter their Firebase and OpenAI keys,
    which are validated and stored in the browser. App initializes clients dynamically.
  </outcome>
</task>

---

<task type="auto" id="02-02">
  <n>Key Gate Middleware & Settings Page</n>
  
  <context>
    Once BYOK is set up, we need:
    - Route protection: redirect to /setup if keys are not configured
    - A settings page where users can view/update/delete their stored keys
    - Visual indicator in header showing connection status
  </context>
  
  <steps>
    1. Update `KeyProvider.tsx` — check for stored keys on mount, expose `isConfigured` state
    2. Create `src/components/layout/KeyGate.tsx` — wrapper that redirects to /setup if not configured
    3. Update recruiter layout to wrap content with KeyGate
    4. Create `src/app/(recruiter)/settings/page.tsx` — settings page with:
       - View current key status (connected/not connected, masked key preview)
       - Update individual keys
       - "Reset All Keys" button with confirmation
       - Connection health check (ping Firebase + OpenAI)
    5. Add connection status indicator to Header (green dot = connected, red = not configured)
    6. Update landing page CTA to route to /setup for first-time users
    7. Verify: Fresh browser → redirected to /setup. After keys → dashboard accessible. Settings shows key status.
    8. Commit: `feat(02-28): Phase 2 — BYOK API key management`
  </steps>
  
  <verify>npm run build && npm run dev</verify>
  
  <outcome>
    Complete BYOK system: setup wizard, key gating, settings management,
    connection health indicators. No .env keys required for demo usage.
  </outcome>
</task>
